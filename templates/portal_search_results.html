{%- extends 'base.html' %}

{% block title %}{{ config['APP_NAME'] }}: Search Results{% endblock %}

{% block styles %}
{{super()}}
<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/jquery.dataTables.min.css')}}">
{% endblock %}

{% block scripts %}
{{super()}}
<script type="text/javascript">
var typeahead_genes = [
{% for gene in typeahead_genes %}
'{{gene}}',
{% endfor %}
];
</script>
<script src="{{url_for('static', filename='js/typeahead.bundle.js')}}"></script>
<script src="{{url_for('static', filename='js/portal.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.dataTables.min.js')}}"></script>
{% endblock %}

{% block page_content %}
<h1>{{ config['APP_NAME'] }} Search Results</h1>

<div id="browse-search-row" class="row">
    <div class="col-md-5">
        <form action="search" method="get">
            <div class="input-group">
                <input id="gene-input" type="text" name="g" class="form-control typeahead" placeholder="Feature name">
                <span class="input-group-btn">
                        <button type="submit" class="btn btn-default btn-search" type="button">Search</button>
                    </span>
            </div>
        </form>
    </div>
</div>

<p class="text-muted">Click on any alteration below to view more details about the alteration-actionability relationship.</p>

<table class="results-table display compact">
    <thead>
    <tr><th>Feature</th><th>Feature type</th><th>Alt. type</th><th>Alteration</th><th>Therapy</th><th>Therapy class</th><th>Response</th><th>Cancer Type</th><th>Predictive Level</tr>
    </thead>
    <tbody>
    {% for row in rows %}
    <tr>
        <td>{% if row['gene_name'] %}<a href="search?g={{row['gene_name']|urlencode}}">{{row['gene_name']}}</a>{% endif %}</td>
        <td>{{row['feature'] if row['feature'] is not none}}</td>
        <td>{{row['alt_type'] if row['alt_type'] is not none}}</td>
        <td><a href="assertion/{{row['assertion_id']|urlencode}}">{{row['alt'] if row['alt'] is not none else '(any)'}}</a></td>
        <td>{% if row['therapy_name'] %}<a href="search?t={{row['therapy_name']|urlencode}}">{{row['therapy_name']}}</a>{% endif %}</td>
        <td>{% if row['therapy_class'] %}{{row['therapy_class']}}{% endif %}</td>
        {% if row['therapy_sensitivity'] != None %}
        <td>{% if row['therapy_sensitivity'] == 1 %}Sensitivity{% elif row['therapy_sensitivity'] == 0 %}Not sensitive{% endif %}</td>
        {% elif row['therapy_resistance'] != None %}
        <td>{% if row['therapy_resistance'] == 1 %}Resistance{% elif row['therapy_resistance'] == 0 %}Not resistance{% endif %}</td>
        {% elif row['favorable_prognosis'] != None %}
        <td>{% if row['favorable_prognosis'] %}Good{% else %}Poor{% endif %} prognosis</td>
        {% endif %}

        <td>{% if row['disease'] %}<a href="search?d={{row['disease']|urlencode}}">{{row['disease']}}{% endif %}</td>
        {%if row['predictive_implication'] is not none %}
        <td data-order="{{pred_impl_orders[row['predictive_implication']]}}"><a href="search?p={{row['predictive_implication']|urlencode}}">{{row['predictive_implication']}}</a></td>
        {% else %}
        <td></td>
        {% endif %}

    </tr>
    {% endfor %}
    </tbody>
</table>
{%- endblock %}
